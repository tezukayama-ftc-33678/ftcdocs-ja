.. _first field coordinate system:

*FIRST* Tech Challenge フィールド座標系の定義
=========================================================

.. meta::
   :description: このドキュメントは、競技フィールド上の位置を指定するために使用できる FIRST Tech Challenge フィールド座標系を定義します。

概要: *FIRST* Tech Challenge フィールド座標系は、3次元のデカルト座標系です。
X軸とY軸はフィールド上の位置を示し、Z軸はフィールドからの高さを示します。

範囲
-----
  
このドキュメントは、*FIRST* Tech Challenge 競技フィールドのフィールド座標系を定義します。この定義は、
一貫性のあるフィールド中心のナビゲーション、ターゲットの位置特定、および経路計画に使用できます。

基準フレーム
---------------

この定義の基準フレームは、赤アライアンスエリアに隣接するフィールド外周壁で、以降は赤ウォール（Red Wall）と呼びます。この定義は、
フィールドの外側に立ち、赤ウォールの中央から、フィールドの中心に向かって見ている人の視点に基づいています。

.. note:: 
   赤アライアンスエリアが2つの外周壁に隣接している場合、
   赤ウォールはアライアンスエリアと *最も* 接触している壁になります。赤アライアンスエリアが2つの外周壁に *均等に* 隣接している場合、
   時計回りで最も近い方の壁が赤ウォールとみなされます。
   
座標系
-----------------

フィールド座標系は、3次元のデカルト座標系です。
XとYはフィールド上の位置を示します。
Zはフィールドからの高さを示します。
3つの軸すべてに同じ長さの単位を使用する限り、任意の長さの単位を使用できます。
座標は(X, Y, Z)の順序で表されます。
例: 座標位置(10, -10, 0)は、X = 10、Y = -10、Z = 0です。

原点
^^^^^^

*FIRST* Tech Challenge 座標系の0,0,0原点は、
4つの外周壁すべてから等距離にあるフィールドの中心点です（4つの中央タイルが交わる場所）。原点は、フロアマットの
上面に位置します。

X軸
^^^^^^

赤ウォールから原点を見た場合、X軸は原点を通り、赤ウォールに平行に左右に延びています。X軸の値は
右に向かって増加します。

Y軸
^^^^^^

赤ウォールから原点を見た場合、Y軸は原点を通り、赤ウォールに垂直に前後に延びています。Y値の増加は
赤ウォールから外側（離れる方向）に向かいます。

Z軸
^^^^^^

赤ウォールから原点を見た場合、Z軸は原点を通り、垂直に上下に延びています。Z値の増加は
上方向に延びます。

軸周りの回転
^^^^^^^^^^^^^^^^^^^

軸周りの回転を考える場合、正の端から原点に向かって軸を見下ろしていると考えてください。正の
回転は反時計回りで、負の回転は時計回りです。
   
.. figure:: images/image1.jpg
   :alt: X、Y、Z座標軸。
   
   各軸周りの反時計回りの回転
   
   正のZ軸から原点に向かって見下ろしていることを想像してください。
   これは、フィールドの中央に立って下を見ているようなものです。
   Z軸周りの正の回転は反時計回りになります。

例: フィールド上で時計回りに回転しているロボットは、Z軸周りの負の回転を行っています。

フィールド構成の例
----------------------------

以下は、さまざまな *FIRST* Tech Challenge フィールド構成に対するフィールド座標系を示す2つの例です。

.. note::
   両方のフィールド構成において、赤アライアンスは正のY軸に沿って外側を向いており、
   Z軸はフィールドの中心から上向きに指しています。

ダイヤモンドフィールド
^^^^^^^^^^^^^

.. figure:: images/first-res-q-field.png
   :alt: X、Y、Z軸が表示されたダイヤモンドフィールド。
   
   FIRST RES-Q 競技フィールド
   
   ダイヤモンドフィールド構成では、2つのアライアンスウォールが隣接しています。
   フィールドは45度回転しており、両方のアライアンスが観客に面しています。
   観客の視点から見ると、フィールドはダイヤモンド形状を形成します。
   赤ウォールは観客から見て右側にあります。
   Y軸は、赤ウォールから見てフィールドを横切る方向を指しています。
   X軸は青アライアンスを指しています。
   
スクエアフィールド
^^^^^^^^^^^^

.. figure:: images/into-the-deep-field.png
   :alt: X、Y、Z軸が表示されたスクエアフィールド。
   
   Into The Deep 競技フィールド
   
   スクエアフィールド構成では、2つのアライアンスがフィールドを挟んで向かい合っています。
   
   * フィールドの向きは、観客から見て赤ウォールが右側にあります。
   * Y軸は、赤ウォールから青アライアンスに向かってフィールドを横切る方向を指しています。
   * X軸は、観客から離れてフィールドの後方を指しています。

スクエアフィールド（アライアンスエリア反転）
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

.. figure:: images/decode-field.png
   :alt: アライアンスエリアが反転した、X、Y、Z軸が表示されたスクエアフィールド。
   
   DECODE 競技フィールド
   
   DECODE 競技フィールドは基本的にスクエアフィールドですが、赤と青のアライアンス
   エリアが通常の構成から入れ替わっています（観客から見て赤アライアンスエリアが左側）。この構成では、XとY軸が
   正の軸が指す方向で「反転」しています。これはフィールド座標系の定義と一致していますが、
   フィールドが反転しています。
   
   * フィールドの向きは、観客から見て赤ウォールが左側にあります。
   * Y軸は、赤ウォールから青アライアンスに向かってフィールドを横切る方向を指しています。
   * X軸は、観客に向かってフィールドの前方を指しています。


座標位置の例
---------------------------

DECODE フィールド（赤/青が反転したスクエアフィールド）上の座標(-58.3727, 55.6425, 29.5)（単位: インチ）を考えてみましょう。
座標の順序から、X = -58.3727、Y = 55.6425、Z = 29.5となります。

* X軸の値-58.3727は、フィールドの奥（観客ウォールから離れた場所）に位置しています。
* Y軸の値55.6425は、青ウォールの近くに位置し、青ウォールからタイル約3/4個分の長さの距離にあります。
* Z軸の値29.5は、フィールドタイルから29.5インチ上にあります。

この座標セットは、赤ゴール上の赤ゴール **AprilTag** の中心です。 

測定値
---------------

以下のメートル法の値は、2016年の競技フィールドから測定されたものです。これらは
代表的な値のみであり、正確であること、または保証されていることを前提としないでください。

-  パネルの反対側の内面間の距離: 3580 mm
   (フィールドが適切に組み立てられている場合: ストラップによる調整余裕があります)
-  ポリカーボネート透明板の可視開口高さ: 255 mm
-  透明板の上端は外周の上部から30 mm
-  外周の全高さ: 313 mm
-  タイルの厚さ: 13 mm

したがって、ダイヤモンドフィールド構成の場合、観客に最も近いフィールドの角で、
外周壁の上部と同じ高さにある点の座標位置は、ミリメートル単位で(-1790, 1790, 300)になります。

追加情報
----------------------

3次元の `デカルト座標系
<https://en.wikipedia.org/wiki/Cartesian_coordinate_system#Three_dimensions>`__
に関するWikipediaの記事を参照してください。
フィールド座標系の回転規約は、
古典幾何学の `右手の法則 <https://en.wikipedia.org/wiki/Right-hand_rule>`__ 
に由来しています。

ウェブカメラを搭載したロボットは、:ref:`AprilTags <apriltag/vision_portal/apriltag_intro/apriltag-intro:apriltag introduction>`
を使用して、ロボットに対して :ref:`AprilTag がどこに位置しているか
<apriltag/understanding_apriltag_detection_values/understanding-apriltag-detection-values:introduction>` 
を判断できます。
**AprilTag** はフィールド上の既知の位置にあるため、
:ref:`ロボットの位置 <apriltag/vision_portal/apriltag_localization/apriltag-localization:apriltag localization>`
もフィールド上で判断できます。

ロボットは、慣性計測ユニット（**IMU**）を使用して、ロボットに対する軸周りの回転を測定できます。
:ref:`IMU 軸の定義 <programming_resources/imu/imu:axes definition>` を参照してください。
**IMU** からのヨー値（方位角とも呼ばれます）は、ロボットから上向きに指すZ軸周りの回転を測定します。
**IMU** を使用して、ロボットがどの方向を向いているかを判断できます。

