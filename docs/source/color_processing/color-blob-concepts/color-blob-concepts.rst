カラーブロブの概念
===================

カラーブロブ
-----------

画像は、**類似した色のグループ化**によって評価できます。

デジタル画像の最小単位は**ピクセル**です。これは、1つの特定の色の小さな正方形です。

類似した色のピクセルの各グループまたはクラスターは**ブロブ（Blob）**と呼ばれ、サイズと形状が不規則である可能性があります。

ブロブの形成は、ソフトウェアによって自動的に行われます。ソフトウェアは、**隣接している**類似した色のピクセル、つまり角だけでなく辺に沿って互いに接触しているピクセルを探します。

.. figure:: images/10-Blobs-formation.png
   :width: 75%
   :align: center
   :alt: ブロブ形成の視覚化

   ブロブ形成の視覚化

ここには4つではなく、9つのブロブがあります。いくつかは非常に小さく、それぞれ1ピクセルだけです。

例えば、右上の5つのピクセルは隣接していない（辺が接続していない）ため、より大きなブロブを形成するために結合されません。

上記のシンプルな例には、黒と白の2色しかありません。FTCの場合、「類似」色の定義は、皆さんが指定する範囲です。

.. figure:: images/20-Blobs-red-chair.png
   :width: 75%
   :align: center
   :alt: 赤い椅子の画像からブロブを定義

   赤い椅子の画像からのブロブ

上記の例では、椅子の表面は**正確に**同じ赤の色合いではありません。しかし、「赤に近い」または「ほとんど赤」という**ターゲット**定義により、ソフトウェアはさらなる処理のために妥当なブロブを形成できます。

カラー処理
----------------

次に、**Sample**と呼ばれるINTO THE DEEPのゲーム要素にカメラを向けてみましょう。

.. figure:: images/30-Blobs-blue-basic.png
   :width: 75%
   :align: center
   :alt: 青いSAMPLEからブロブを検出

   青いSAMPLEからのブロブ

ここでは、ソフトウェアに青の色合いを探すように指示しました。オレンジ色の長方形が、青い色のブロブを囲んでいます。

しかし、なぜ長方形はゲーム要素全体を囲んでいないのでしょうか？ソフトウェアは、特定の**関心領域（Region of Interest）**またはROIのみを処理しています。それが白い長方形です。そのサイズと位置は皆さんが指定します。

ROIの外側にあるものは、検出されたブロブの一部とは見なされません。これにより、（不要な）背景オブジェクトの検出を回避できます。

上記の例では、ブロブは実際にはティール（青緑色）でアウトライン表示されており、非常に見づらいです。別の画像を試してみましょう：

.. figure:: images/40-Blobs-single.png
   :width: 75%
   :align: center
   :alt: ティールのアウトラインを見つける

   青いブロブのティールのアウトライン

これで、青いブロブのティールのアウトラインが見えます。その形状は不規則で、**OpMode**が評価するのが難しい場合があります。

boxFit長方形
-----------------

オレンジ色の長方形は、**OpenCV**によって自動的に描画され、ブロブを表すよりシンプルな幾何学的形状を**OpMode**に提供します。これは実際のブロブと**正確に**同じではありませんが、それでも役立つことを期待します。

**boxFit**と呼ばれるオレンジ色の長方形は、ブロブの極端な端にぴったりとフィットします。boxFitは、関心領域内に留まる必要は**ありません**。上記のケースでは、最もよくフィットする長方形がたまたまROI内に留まっています。

しかし、別のケースがあります：

.. figure:: images/50-Blobs-tilted.png
   :width: 75%
   :align: center
   :alt: Boxfitの位置を示す

   新しいboxFitの位置

ブロブのティールのアウトラインを、非常に粗い下端とともに、よく見てください。

ここでは、最もよくフィットする長方形（boxFit）が**傾いて**おり、ROI内に含まれていません。

**OpenCV**は、コーナーポイント、サイズ、傾斜角度を含む、boxFitのすべてのデータを提供します。傾いたboxFitを処理したくない場合は、boxFit長方形の水平フィット版を提供することもできます。

さて、物事は少し複雑になります：

.. figure:: images/60-Blobs-two.png
   :width: 75%
   :align: center
   :alt: 2つのブロブを検出

   2つのブロブを検出

**OpenCV**は**2つのブロブ**を検出し、それぞれにティールのアウトラインとboxFitがあります。

皆さんの**OpMode**は、どのboxFitが重要で、どれを無視するかを「決定」する必要があります。幸いなことに、**OpenCV**は特定の不要な結果を**除外する**ツールを提供しています。フィルタリング後、**OpMode**は残りの結果を**ソート**して、最優先事項に焦点を当てることができます。

これらのツールを使用すれば、**OpMode**はこのような「忙しい」結果でも処理できます：

.. figure:: images/70-Blobs-many.png
   :width: 75%
   :align: center
   :alt: 多数のブロブ検出

   多数のブロブ検出

皆さんのプログラミングタスクには以下が含まれます：

* どのboxFitが最も関連性があるかを判断する
* そのデータを評価する
* それに応じてロボットのアクションを実行する

次に、:doc:`Color Locator <../color-locator-discover/color-locator-discover>`プロセッサのサンプル**OpMode**を試してみてください。

============

*質問、コメント、修正は westsiderobotics@verizon.net まで*
