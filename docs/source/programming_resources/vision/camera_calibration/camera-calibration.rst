**FIRST** **Tech Challenge** のカメラ較正
=============================================

カメラ較正とは何か、なぜ必要なのか？
--------------------------------------------------

カメラは、カメラが最終的に「見る」実際の画像に変動をもたらす可能性のある多くの異なるコンポーネントで構成されています。カメラ較正は、カメラとレンズの組み合わせが最終的に世界をどのように見るかを数学的にモデル化するプロセスです。たとえば、視野がどれだけ広いかなどです。カメラを使用して高精度タスクを実行する場合、たとえばカメラを使用して精密測定を実行したり、**AprilTags** などの基準マーカーシステムから正確な 6DOF ポーズデータを取得したりする場合は、カメラを較正する必要があります。較正は、カメラとレンズに固有であるだけでなく、特定のカメラで使用される解像度にも固有であることに注意することが重要です！

.. warning:: 
   屈折率の違いにより、空気中と液体中（たとえば水中）で実行された較正は転送できません。較正は、カメラが動作する媒体内で実行する必要があります。

カメラ較正方法
--------------------------

**OpenCV**、**MATLAB**、**MRCAL** など、カメラを較正する方法は多数あります。

-  上級チームの場合、`MRCAL <https://mrcal.secretsauce.net/>`__ を使用するのが最良の選択肢です - これは NASA JPL によって開発されたツールで、較正がどれだけ優れているか、および最適なパラメーターに到達するための数値最適化に何が含まれるかに関する広範なデータを提供します。
-  その他の私たちのために、ここでは `3DF Zephyr <https://www.3dflow.net/3df-zephyr-free/>`__ を使用してカメラを較正する方法を説明します。これは非常に使いやすく、妥当な結果を提供できます。

.. warning::
   **3DF Zephyr** は Microsoft Windows 64ビットアプリケーションです。32ビットバージョンの Windows ではサポートされておらず、Mac または Linux プラットフォームでもサポートされていません。


**3DF Zephyr** を使用した較正
-----------------------------

1. `3DF Zephyr Free Edition <https://www.3dflow.net/3df-zephyr-free/>`__ をダウンロードしてインストールします。
2. サンプル ``UtilityCameraFrameCapture`` **OpMode** を teamcode フォルダーにコピーし、ニーズに応じて上部のパラメーターを変更します。このサンプルは Java でのみ記述されていることに注意することが重要です。
3. **3DF Zephyr** で、次の場所に移動します：

   - **Utilities --> Images --> Camera Calibration** 

   そして指示に従います。フレームキャプチャ **OpMode** を使用して写真を撮ります。
4. **Robot Controller** デバイスを USB ケーブルでコンピューターに接続し、キャプチャされたフレームをコンピューターにコピーします。それらは USB ストレージのルートにあり、名前の前に ``VisionPortal-`` が付いています。
5. **3DF Zephyr** で *Add Images* ボタンを押し、コンピューターにコピーした画像を指定します。
6. **3DF Zephyr**で較正ターゲット分析を実行します。完了すると、``fx, fy, cx, cy`` が提供されます。これらは、**AprilTagProcessor** に適用するために必要な較正パラメーターです。


