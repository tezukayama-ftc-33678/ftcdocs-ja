タイマーの例
=============

FTC **タイマー** は、馴染みのある ``.sleep`` ブロックよりもはるかに多くの機能を提供します。Java プログラマーは、`この Blocks チュートリアル <https://github.com/FIRST-Tech-Challenge/FtcRobotController/wiki/Timers-in-FTC-Blocks>`__ からタイマーについて学ぶことができます。そのレッスンは Java プログラムに簡単に適用できます。

**myBlocks** を作成する際、既存の Java コードのセクションを **myBlock** メソッドに変換または「パッケージ化」するときは注意してください。プログラマーとして、 **myBlock** が **OpMode** のどこに配置されるかを検討する必要があります。たとえば、 **myBlock** が **repeat while ループ** 内に配置されている場合、Java メソッドは何度も呼び出されます - これは意図したものである場合とそうでない場合があります。 **Blocks** ユーザーに、ループを含む（または含まない） **myBlock** の実行方法を伝えるために、アノテーション **comment** を使用します。

タイマーに関する特別な注意：新しい FTC タイマーを作成または**インスタンス化**すると、そのタイマーも開始または**リセット**されます。**Blocks** の **repeat ループ**で使用される **myBlock** 内でタイマーが作成されると、そのタイマーは常にリセットされ、意図した時間制限に到達することはありません。

次の例では、 **タイマーの作成** タスクを **タイマーのリセット** タスクから分離しています。

.. image:: images/a0440-Timer-Java.png

15行目：この単一の Java 行は、次のすべてを実行します：
- myStopwatch というフィールドを、型（クラス）ElapsedTime として宣言します
- フィールドは **private** で、このクラス SampleMyBlocks でのみ使用できます
- フィールドは **static** で、**myBlocks** などの static メソッドで使用できます
- **コンストラクター**メソッド ElapsedTime() を呼び出して、**新しい** ElapsedTime インスタンスを**インスタンス化**します
- その**インスタンス**をフィールド myStopwatch に割り当てます

18-19行目は、 **「+」** 文字で結合されて **単一のテキスト文字列** を形成する2つのテキスト文字列（それぞれ引用符内）を再度示しています。これは、コメントフィールドが「改行」なしで **単一行** のテキストである必要があるという要件を満たす別の方法です。

22行目：このメソッドには**入力がありません**（空の括弧）と**出力がありません**（キーワード **void**）。これが、アノテーション @ExportToBlocks に **parameterLabels** フィールドがなかった理由です。

24行目では、パーセント記号で示される**フォーマットコード**を使用してデータが表示されます。**.2f** は、小数点の右側に2桁の数値を表示します。

また、24行目では、オブジェクト myStopwatch がメソッド ``time()`` を使用して、そのタイマーの現在の値を秒単位で取得します。

28行目：二重ストローク演算子 **\|\|** は「OR」を意味します。他の Java 論理演算子は `こちら <https://www.w3schools.com/java/java_operators.asp>`__ にあります。

ブール値「true」または「false」の出力、つまり**戻り値の型**に注意してください。このメソッドの場合、タイマーが指定された時間に達したときに、**return** コマンドは値「true」を **Blocks** プログラムに渡します。それ以外の場合は「false」を渡します。

このようなブール値の出力を持つ **myBlock** は、``.repeat while`` や ``.if/then`` などの **Blocks** 制御構造で使用できます。

.. image:: images/a0450-Timer-Blocks.png

上記の最初の **Blocks** 関数では、myStopwatch 変数を作成して開始します。再度停止するまで、タイマーは実行され続けます。

次の関数は、タイマーが 5.5秒に達するまで、ループを繰り返し実行します。その時点で、関数からのブール値出力により、繰り返しループが停止します。この例では、ループは空です。実際のアプリケーションでは、ループにはロボットアクションが含まれます。

.. note:: このチュートリアルでは、上記の Java コードを**手動で入力**することを意図しています。この例の事前入力されたテキストが必要な場合は、以下をクリックしてください。リンクされたコピーには、通常のクラス宣言とパッケージ/インポート文が含まれています。

.. dropdown:: サンプルコード

   :download:`SampleMyBlocks_v03.java <opmodes/SampleMyBlocks_v03.java>`

   .. literalinclude:: opmodes/SampleMyBlocks_v03.java
      :language: java

必要に応じて、リセット機能を備えた3番目の **myBlock** を追加できます。これにより、**Blocks** ユーザーは、OpMode 中にタイマーを再度ゼロにすることができます。これは、``.reset()`` メソッドで簡単に行えます。
